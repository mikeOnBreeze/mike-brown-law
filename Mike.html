<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mike Brown Law - Personal Injury Champions</title>
    <style>
        @font-face {
            font-family: 'SegaFont';
            src: url('https://cdnjs.cloudflare.com/ajax/libs/webfont/1.6.28/webfontloader.js');
            /* Fallback to a pixel font */
            font-family: 'Courier New', monospace;
        }
        
        /* Add pixel effect to text */
        h1, h2, .button, #score-display, #controls, .money, .lose-text {
            image-rendering: pixelated;
            -webkit-font-smoothing: none;
            text-shadow: 2px 2px 0 #000;
            letter-spacing: 1px;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            font-family: 'SegaFont', monospace;
            color: #fff;
            overflow: hidden;
        }

        #game-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: #000;
        }

        #game-screen {
            width: 640px;
            height: 480px;
            background-color: #0a0a2a;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='640' height='480'%3E%3Cdefs%3E%3ClinearGradient id='sky' x1='0%25' y1='0%25' x2='0%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23104' /%3E%3Cstop offset='100%25' stop-color='%23001' /%3E%3C/linearGradient%3E%3ClinearGradient id='road' x1='0%25' y1='0%25' x2='100%25' y2='0%25'%3E%3Cstop offset='0%25' stop-color='%23444' /%3E%3Cstop offset='100%25' stop-color='%23222' /%3E%3C/linearGradient%3E%3ClinearGradient id='grass' x1='0%25' y1='0%25' x2='100%25' y2='0%25'%3E%3Cstop offset='0%25' stop-color='%23040' /%3E%3Cstop offset='100%25' stop-color='%23020' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='640' height='480' fill='url(%23sky)' /%3E%3Cpath d='M0,0 L640,0 L640,480 L0,480 Z' fill='url(%23sky)' /%3E%3Ccircle cx='580' cy='80' r='40' fill='%23fc0' /%3E%3Ccircle cx='580' cy='80' r='35' fill='%23ff0' /%3E%3Cpath d='M0,280 L640,280 L640,380 L0,380 Z' fill='url(%23road)' /%3E%3Cpath d='M0,380 L640,380 L640,480 L0,480 Z' fill='url(%23grass)' /%3E%3Cpath d='M0,180 L640,180 L640,280 L0,280 Z' fill='url(%23grass)' /%3E%3Cpath d='M0,280 L640,280 L640,290 L0,290 Z' fill='%23888' /%3E%3Cpath d='M0,370 L640,370 L640,380 L0,380 Z' fill='%23888' /%3E%3C/svg%3E");
            position: relative;
            border: 4px solid #444;
            box-shadow: 0 0 10px #00f, 0 0 20px #00a;
            overflow: hidden;
            image-rendering: pixelated;
        }

        #road {
            width: 640px;
            height: 100px;
            position: absolute;
            top: 280px;
            left: 0;
            overflow: hidden;
            background-color: #333;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Cpath d='M0 0h100v100H0z' fill='%23333'/%3E%3Cpath d='M0 0h50v50H0zm50 50h50v50H50z' fill='%23444' opacity='.5'/%3E%3C/svg%3E");
            background-size: 20px 20px;
        }

        .lane-divider {
            width: 100%;
            height: 100px;
            position: absolute;
            top: 280px;
            left: 0;
            z-index: 2;
        }

        .lane-line {
            position: absolute;
            width: 15px;
            height: 50px;
            background-color: #ff0;
            box-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        #player-car {
            width: 100px;
            height: 60px;
            position: absolute;
            left: 100px;
            top: 300px;
            z-index: 10;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 60'%3E%3Cdefs%3E%3ClinearGradient id='carGrad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23ff0000' /%3E%3Cstop offset='100%25' stop-color='%23990000' /%3E%3C/linearGradient%3E%3ClinearGradient id='windowGrad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23aaddff' /%3E%3Cstop offset='100%25' stop-color='%233377aa' /%3E%3C/linearGradient%3E%3ClinearGradient id='wheelGrad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23444444' /%3E%3Cstop offset='100%25' stop-color='%23111111' /%3E%3C/linearGradient%3E%3ClinearGradient id='highlightGrad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23ffffff' stop-opacity='0.7' /%3E%3Cstop offset='100%25' stop-color='%23ffffff' stop-opacity='0' /%3E%3C/linearGradient%3E%3C/defs%3E%3C!-- Main car body --%3E%3Cpath d='M5,30 L15,15 L30,10 L70,10 L85,15 L95,30 L95,45 L5,45 Z' fill='url(%23carGrad)' /%3E%3C!-- Roof and windows --%3E%3Cpath d='M25,15 L35,15 L40,25 L60,25 L65,15 L75,15' fill='none' stroke='%23cc0000' stroke-width='2' /%3E%3Cpath d='M30,15 L40,25 L60,25 L70,15' fill='url(%23windowGrad)' /%3E%3C!-- Front window --%3E%3Cpath d='M70,15 L80,15 L85,25 L70,25 Z' fill='url(%23windowGrad)' /%3E%3C!-- Rear window --%3E%3Cpath d='M20,15 L30,15 L30,25 L15,25 Z' fill='url(%23windowGrad)' /%3E%3C!-- Lower body details --%3E%3Cpath d='M5,30 L5,45 L95,45 L95,30 Z' fill='%23770000' /%3E%3Cpath d='M5,35 L95,35' stroke='%23550000' stroke-width='1' /%3E%3Cpath d='M5,40 L95,40' stroke='%23550000' stroke-width='1' /%3E%3C!-- Wheels --%3E%3Ccircle cx='25' cy='45' r='8' fill='url(%23wheelGrad)' /%3E%3Ccircle cx='25' cy='45' r='5' fill='%23333' /%3E%3Ccircle cx='25' cy='45' r='2' fill='%23777' /%3E%3Ccircle cx='75' cy='45' r='8' fill='url(%23wheelGrad)' /%3E%3Ccircle cx='75' cy='45' r='5' fill='%23333' /%3E%3Ccircle cx='75' cy='45' r='2' fill='%23777' /%3E%3C!-- Headlights and taillights --%3E%3Cpath d='M85,30 L90,30 L90,35 L85,35 Z' fill='%23ffcc00' /%3E%3Cpath d='M10,30 L15,30 L15,35 L10,35 Z' fill='%23ff3300' /%3E%3C!-- Highlights and shadows --%3E%3Cpath d='M15,15 L85,15' stroke='%23ffffff' stroke-width='1' opacity='0.5' /%3E%3Cpath d='M30,10 L70,10' stroke='%23ffffff' stroke-width='1' opacity='0.5' /%3E%3Cpath d='M5,30 L95,30' stroke='%23000000' stroke-width='1' opacity='0.5' /%3E%3C!-- Pixelated details --%3E%3Crect x='45' y='20' width='10' height='5' fill='%23cc0000' /%3E%3Crect x='40' y='35' width='20' height='5' fill='%23550000' /%3E%3Crect x='65' y='30' width='5' height='5' fill='%23cc0000' /%3E%3Crect x='30' y='30' width='5' height='5' fill='%23cc0000' /%3E%3C/svg%3E");
            image-rendering: pixelated;
        }

        .traffic-car {
            position: absolute;
            z-index: 8;
            background-repeat: no-repeat;
            background-size: contain;
        }

        #hitbox-indicator {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: rgba(255, 0, 0, 0.3);
            border-radius: 50%;
            z-index: 9;
            display: none; /* For debugging only */
        }

        #score-display {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 24px;
            color: #ff0;
            text-shadow: 2px 2px 0 #f00;
        }

        #time-display {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            color: #ff0;
            text-shadow: 2px 2px 0 #f00;
        }

        #title-screen, #crash-screen, #win-screen, #lose-screen {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 100, 0.8);
            z-index: 100;
            text-align: center;
            display: none;
        }

        #title-screen {
            display: flex;
        }

        h1 {
            font-size: 48px;
            color: #ff0;
            text-shadow: 4px 4px 0 #f00;
            margin-bottom: 30px;
        }

        h2 {
            font-size: 36px;
            color: #0f0;
            text-shadow: 2px 2px 0 #00f;
            margin-bottom: 20px;
        }

        .button {
            padding: 15px 30px;
            font-size: 24px;
            background: linear-gradient(to bottom, #f00, #900);
            color: #fff;
            border: 4px solid #700;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px;
            text-shadow: 2px 2px 0 #000;
            box-shadow: 0 0 10px #f00;
            font-family: 'SegaFont', monospace;
            position: relative;
            overflow: hidden;
        }

        .button:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
        }

        .button:hover {
            background: linear-gradient(to bottom, #f00, #a00);
            transform: scale(1.05);
        }
        
        .button:hover:before {
            left: 100%;
        }
        
        .button:active {
            transform: scale(0.95);
        }

        #controls {
            position: absolute;
            bottom: 20px;
            font-size: 18px;
            color: #0f0;
        }

        .money {
            font-size: 36px;
            color: #0f0;
            text-shadow: 2px 2px 0 #090;
            margin: 10px 0;
        }

        .lose-text {
            font-size: 36px;
            color: #f00;
            text-shadow: 2px 2px 0 #900;
            margin: 10px 0;
        }

        .pixel-art {
            image-rendering: pixelated;
        }

        #law-contact {
            margin-top: 20px;
            font-size: 20px;
            color: #fff;
            text-shadow: 1px 1px 0 #00f;
        }

        /* Contact form section */
        #contact-section {
            display: none;
            position: absolute;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 80, 0.9);
            z-index: 200;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
        }

        #contact-form {
            width: 80%;
            max-width: 500px;
            padding: 20px;
            background-color: #000;
            border: 4px solid #00f;
            border-radius: 10px;
            box-shadow: 0 0 20px #00f;
        }

        .form-field {
            margin-bottom: 15px;
            text-align: left;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #0f0;
            font-size: 18px;
        }

        input, textarea {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            background-color: #111;
            border: 2px solid #00f;
            color: #fff;
            border-radius: 5px;
            font-family: 'SegaFont', monospace;
        }

        /* About section */
        #about-section {
            width: 100%;
            padding: 40px;
            background-color: #000;
            text-align: center;
            box-sizing: border-box;
            display: none;
        }

        #about-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #0a0a2a;
            border: 4px solid #00f;
            border-radius: 10px;
            box-shadow: 0 0 20px #00f;
        }

        .profile {
            margin-top: 30px;
        }

        /* Navigation */
        #nav-buttons {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
        }

        .nav-button {
            padding: 5px 10px;
            background: linear-gradient(to bottom, #00f, #009);
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'SegaFont', monospace;
        }

        #crash-animation {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: transparent;
            z-index: 50;
            display: none;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="game-screen">
            <!-- Title Screen -->
            <div id="title-screen">
                <h1>MIKE BROWN LAW</h1>
                <h2>FENDER BENDER DEFENDER</h2>
                <button class="button" id="start-button">START GAME</button>
                <div id="controls">Use UP and DOWN arrow keys to change lanes and avoid aggressive drivers</div>
            </div>

            <!-- Game Elements -->
            <div id="score-display">SCORE: 0</div>
            <div id="time-display">TIME: 0s</div>
            <div id="road"></div>
            <div class="lane-divider" id="lane-divider"></div>
            <div id="player-car"></div>
            <div id="hitbox-indicator"></div>
            <div id="crash-animation"></div>

            <!-- Crash Screen -->
            <div id="crash-screen">
                <h1>CRASH!</h1>
                <h2>You've been in a side-impact collision!</h2>
                <button class="button" id="call-button">CALL MIKE BROWN LAW</button>
                <button class="button" id="no-call-button">HANDLE IT YOURSELF</button>
            </div>

            <!-- Win Screen -->
            <div id="win-screen">
                <h1>VICTORY!</h1>
                <h2>Mike Brown Law Gets You Paid!</h2>
                <div class="money">$ $ $ BILLS PAID $ $ $</div>
                <div class="money">MEDICAL BILLS COVERED</div>
                <div class="money">COMPENSATION MAXIMIZED</div>
                <div id="law-contact">
                    <p>Contact us now for your real case:</p>
                    <p>Phone: (555) MIKE-LAW</p>
                </div>
                <button class="button" id="contact-button">CONTACT NOW</button>
                <button class="button" id="play-again-button">PLAY AGAIN</button>
                <button class="button" id="about-button">ABOUT MIKE BROWN LAW</button>
            </div>

            <!-- Lose Screen -->
            <div id="lose-screen">
                <h1>GAME OVER</h1>
                <h2>You tried to handle it yourself...</h2>
                <div class="lose-text">NO COMPENSATION</div>
                <div class="lose-text">STUCK WITH BILLS</div>
                <div class="lose-text">INSURANCE GAVE YOU NOTHING</div>
                <div id="law-contact">
                    <p>Don't make this mistake in real life:</p>
                    <p>Call Mike Brown Law at (555) MIKE-LAW</p>
                </div>
                <button class="button" id="try-again-button">TRY AGAIN</button>
            </div>

            <!-- Navigation Buttons -->
            <div id="nav-buttons">
                <button class="nav-button" id="game-nav">GAME</button>
                <button class="nav-button" id="about-nav">ABOUT</button>
                <button class="nav-button" id="contact-nav">CONTACT</button>
            </div>
        </div>

        <!-- Contact Form Section -->
        <div id="contact-section">
            <h1>CONTACT MIKE BROWN LAW</h1>
            <form id="contact-form">
                <div class="form-field">
                    <label for="name">YOUR NAME:</label>
                    <input type="text" id="name" name="name" required>
                </div>
                <div class="form-field">
                    <label for="phone">PHONE NUMBER:</label>
                    <input type="tel" id="phone" name="phone" required>
                </div>
                <div class="form-field">
                    <label for="email">EMAIL:</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div class="form-field">
                    <label for="message">YOUR CASE DETAILS:</label>
                    <textarea id="message" name="message" rows="4" required></textarea>
                </div>
                <button type="submit" class="button">SUBMIT CASE</button>
                <button type="button" class="button" id="back-button">BACK</button>
            </form>
        </div>

        <!-- About Section -->
        <div id="about-section">
            <div id="about-content">
                <h1>ABOUT MIKE BROWN LAW</h1>
                <h2>PERSONAL INJURY CHAMPIONS</h2>
                <p>Founded in Orange County, California, Mike Brown Law specializes in getting maximum compensation for personal injury victims. Our firm handles car accidents, slip and falls, workplace injuries, and more.</p>
                
                <div class="profile">
                    <h2>MIKE BROWN, ESQ.</h2>
                    <p>With over 15 years of experience fighting for the injured, Mike Brown has recovered millions for his clients. He brings the same competitive spirit to the courtroom that you see in this game - he plays to win!</p>
                </div>
                
                <p>Our no-fee guarantee means you don't pay unless we win your case. Just like in the game, calling Mike Brown Law is always the right move after an accident.</p>
                
                <button class="button" id="about-back-button">BACK TO GAME</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Game variables
            let gameActive = false;
            let score = 0;
            let gameTime = 0;
            let playerLane = 1; // Middle lane (0-2)
            let trafficCars = [];
            let crashTimeout;
            let lanePositionsY = [300, 320, 340]; // Y positions for the 3 lanes
            let roadLines = [];
            let gameTimer;
            let aggressiveDriverSpawned = false;

            // Car colors for variety
            const carColors = [
                "#00a", "#080", "#a09", "#088", "#808", "#088", "#840", "#088", "#444"
            ];

            // Car types (0: normal, 1: truck, 2: sports car)
            const carTypes = [0, 0, 0, 0, 1, 0, 0, 2, 0];

            // DOM elements
            const gameScreen = document.getElementById('game-screen');
            const titleScreen = document.getElementById('title-screen');
            const crashScreen = document.getElementById('crash-screen');
            const winScreen = document.getElementById('win-screen');
            const loseScreen = document.getElementById('lose-screen');
            const contactSection = document.getElementById('contact-section');
            const aboutSection = document.getElementById('about-section');
            const playerCar = document.getElementById('player-car');
            const laneDivider = document.getElementById('lane-divider');
            const scoreDisplay = document.getElementById('score-display');
            const timeDisplay = document.getElementById('time-display');
            const crashAnimation = document.getElementById('crash-animation');
            const hitboxIndicator = document.getElementById('hitbox-indicator');

            // Buttons
            const startButton = document.getElementById('start-button');
            const callButton = document.getElementById('call-button');
            const noCallButton = document.getElementById('no-call-button');
            const playAgainButton = document.getElementById('play-again-button');
            const tryAgainButton = document.getElementById('try-again-button');
            const contactButton = document.getElementById('contact-button');
            const backButton = document.getElementById('back-button');
            const aboutButton = document.getElementById('about-button');
            const aboutBackButton = document.getElementById('about-back-button');
            
            // Nav buttons
            const gameNav = document.getElementById('game-nav');
            const aboutNav = document.getElementById('about-nav');
            const contactNav = document.getElementById('contact-nav');

            // Initialize lane dividers
            function initLanes() {
                laneDivider.innerHTML = '';
                roadLines = [];
                
                // Create lane lines (dashed yellow lines)
                for (let lane = 0; lane < 2; lane++) { // 2 dividers for 3 lanes
                    for (let i = 0; i < 10; i++) { // 10 dashes per lane
                        const line = document.createElement('div');
                        line.className = 'lane-line';
                        line.style.top = (lane * 20 + 310) + 'px'; // Position between lanes
                        line.style.left = (i * 70) + 'px';
                        laneDivider.appendChild(line);
                        
                        roadLines.push({
                            element: line,
                            x: i * 70,
                            lane: lane
                        });
                    }
                }
            }

            // Update player car lane position
            function updatePlayerLane() {
                playerCar.style.top = lanePositionsY[playerLane] + 'px';
                
                // Update hitbox indicator for debugging
                updateHitboxPosition();
            }
            
            // Update hitbox indicator (for debugging)
            function updateHitboxPosition() {
                hitboxIndicator.style.left = (playerCar.offsetLeft + 90) + 'px';
                hitboxIndicator.style.top = (parseInt(playerCar.style.top) + 30) + 'px';
            }

            // Create a traffic car
            function createTrafficCar(isRearEndCar = false) {
                const car = document.createElement('div');
                car.className = 'traffic-car';
                
                // Randomize car appearance
                const carTypeIndex = Math.floor(Math.random() * carTypes.length);
                const carType = carTypes[carTypeIndex];
                const carColor = carColors[Math.floor(Math.random() * carColors.length)];
                
                // Size based on car type
                let width, height;
                if (carType === 1) { // Truck
                    width = 140;
                    height = 80;
                } else if (carType === 2) { // Sports car
                    width = 110;
                    height = 50;
                } else { // Normal car
                    width = 100;
                    height = 60;
                }
                
                car.style.width = width + 'px';
                car.style.height = height + 'px';
                
                // Create car SVG based on type and color
                let carSvg;
                if (carType === 1) { // Truck
                    carSvg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 140 80">
                        <defs>
                            <linearGradient id="truckGrad${Math.random()}" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="${carColor}" />
                                <stop offset="100%" stop-color="${darkenColor(carColor)}" />
                            </linearGradient>
                            <linearGradient id="windowGrad${Math.random()}" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="#aaddff" />
                                <stop offset="100%" stop-color="#3377aa" />
                            </linearGradient>
                            <linearGradient id="wheelGrad${Math.random()}" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="#444444" />
                                <stop offset="100%" stop-color="#111111" />
                            </linearGradient>
                        </defs>
                        <!-- Main truck body -->
                        <path d="M10,30 L20,15 L40,15 L50,30 L130,30 L130,60 L10,60 Z" fill="url(#truckGrad${Math.random()})" />
                        <!-- Cab details -->
                        <path d="M20,15 L40,15 L50,30 L20,30 Z" fill="url(#truckGrad${Math.random()})" stroke="#000" stroke-width="1" />
                        <!-- Windows -->
                        <path d="M25,18 L35,18 L40,27 L25,27 Z" fill="url(#windowGrad${Math.random()})" />
                        <!-- Cargo area -->
                        <rect x="55" y="35" width="70" height="20" fill="${lightenColor(carColor)}" stroke="#000" stroke-width="1" />
                        <!-- Wheels -->
                        <circle cx="30" cy="60" r="10" fill="url(#wheelGrad${Math.random()})" />
                        <circle cx="30" cy="60" r="6" fill="#333" />
                        <circle cx="30" cy="60" r="3" fill="#777" />
                        <circle cx="70" cy="60" r="10" fill="url(#wheelGrad${Math.random()})" />
                        <circle cx="70" cy="60" r="6" fill="#333" />
                        <circle cx="70" cy="60" r="3" fill="#777" />
                        <circle cx="110" cy="60" r="10" fill="url(#wheelGrad${Math.random()})" />
                        <circle cx="110" cy="60" r="6" fill="#333" />
                        <circle cx="110" cy="60" r="3" fill="#777" />
                        <!-- Lights -->
                        <rect x="10" y="35" width="5" height="5" fill="#ffcc00" />
                        <rect x="125" y="35" width="5" height="5" fill="#ff3300" />
                        <!-- Cargo details -->
                        <line x1="55" y1="40" x2="125" y2="40" stroke="#000" stroke-width="1" />
                        <line x1="55" y1="45" x2="125" y2="45" stroke="#000" stroke-width="1" />
                        <line x1="55" y1="50" x2="125" y2="50" stroke="#000" stroke-width="1" />
                        <!-- Pixelated details -->
                        <rect x="60" y="37" width="10" height="3" fill="${darkenColor(carColor)}" />
                        <rect x="80" y="42" width="10" height="3" fill="${darkenColor(carColor)}" />
                        <rect x="100" y="47" width="10" height="3" fill="${darkenColor(carColor)}" />
                    </svg>`;
                } else if (carType === 2) { // Sports car
                    carSvg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 110 50">
                        <defs>
                            <linearGradient id="sportsGrad${Math.random()}" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="${carColor}" />
                                <stop offset="100%" stop-color="${darkenColor(carColor)}" />
                            </linearGradient>
                            <linearGradient id="windowGrad${Math.random()}" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="#aaddff" />
                                <stop offset="100%" stop-color="#3377aa" />
                            </linearGradient>
                            <linearGradient id="wheelGrad${Math.random()}" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="#444444" />
                                <stop offset="100%" stop-color="#111111" />
                            </linearGradient>
                        </defs>
                        <!-- Main car body - lower and sleeker -->
                        <path d="M5,25 L15,15 L30,10 L80,10 L95,15 L105,25 L105,40 L5,40 Z" fill="url(#sportsGrad${Math.random()})" />
                        <!-- Roof and windows - more angular -->
                        <path d="M30,15 L40,15 L45,20 L65,20 L70,15 L80,15" fill="none" stroke="${darkenColor(carColor)}" stroke-width="2" />
                        <path d="M35,15 L45,20 L65,20 L75,15" fill="url(#windowGrad${Math.random()})" />
                        <!-- Lower body details -->
                        <path d="M5,25 L5,40 L105,40 L105,25 Z" fill="${darkenColor(carColor)}" />
                        <!-- Wheels -->
                        <circle cx="30" cy="40" r="8" fill="url(#wheelGrad${Math.random()})" />
                        <circle cx="30" cy="40" r="5" fill="#333" />
                        <circle cx="30" cy="40" r="2" fill="#777" />
                        <circle cx="80" cy="40" r="8" fill="url(#wheelGrad${Math.random()})" />
                        <circle cx="80" cy="40" r="5" fill="#333" />
                        <circle cx="80" cy="40" r="2" fill="#777" />
                        <!-- Lights -->
                        <path d="M5,25 L10,25 L10,30 L5,30 Z" fill="#ffcc00" />
                        <path d="M100,25 L105,25 L105,30 L100,30 Z" fill="#ff3300" />
                        <!-- Highlights and shadows -->
                        <path d="M15,15 L95,15" stroke="#ffffff" stroke-width="1" opacity="0.5" />
                        <path d="M30,10 L80,10" stroke="#ffffff" stroke-width="1" opacity="0.5" />
                        <path d="M5,25 L105,25" stroke="#000000" stroke-width="1" opacity="0.5" />
                        <!-- Pixelated details -->
                        <rect x="50" y="15" width="10" height="5" fill="${darkenColor(carColor)}" />
                        <rect x="45" y="30" width="20" height="5" fill="${darkenColor(carColor)}" />
                        <rect x="20" y="25" width="5" height="5" fill="${darkenColor(carColor)}" />
                        <rect x="85" y="25" width="5" height="5" fill="${darkenColor(carColor)}" />
                        <!-- Spoiler -->
                        <rect x="95" y="15" width="5" height="10" fill="${darkenColor(carColor)}" />
                    </svg>`;
                } else { // Normal car
                    carSvg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 60">
                        <defs>
                            <linearGradient id="carGrad${Math.random()}" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="${carColor}" />
                                <stop offset="100%" stop-color="${darkenColor(carColor)}" />
                            </linearGradient>
                            <linearGradient id="windowGrad${Math.random()}" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="#aaddff" />
                                <stop offset="100%" stop-color="#3377aa" />
                            </linearGradient>
                            <linearGradient id="wheelGrad${Math.random()}" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="#444444" />
                                <stop offset="100%" stop-color="#111111" />
                            </linearGradient>
                        </defs>
                        <!-- Main car body -->
                        <path d="M5,30 L15,15 L30,10 L70,10 L85,15 L95,30 L95,45 L5,45 Z" fill="url(#carGrad${Math.random()})" />
                        <!-- Roof and windows -->
                        <path d="M25,15 L35,15 L40,25 L60,25 L65,15 L75,15" fill="none" stroke="${darkenColor(carColor)}" stroke-width="2" />
                        <path d="M30,15 L40,25 L60,25 L70,15" fill="url(#windowGrad${Math.random()})" />
                        <!-- Lower body details -->
                        <path d="M5,30 L5,45 L95,45 L95,30 Z" fill="${darkenColor(carColor)}" />
                        <path d="M5,35 L95,35" stroke="${darkenColor(carColor)}" stroke-width="1" />
                        <path d="M5,40 L95,40" stroke="${darkenColor(carColor)}" stroke-width="1" />
                        <!-- Wheels -->
                        <circle cx="25" cy="45" r="8" fill="url(#wheelGrad${Math.random()})" />
                        <circle cx="25" cy="45" r="5" fill="#333" />
                        <circle cx="25" cy="45" r="2" fill="#777" />
                        <circle cx="75" cy="45" r="8" fill="url(#wheelGrad${Math.random()})" />
                        <circle cx="75" cy="45" r="5" fill="#333" />
                        <circle cx="75" cy="45" r="2" fill="#777" />
                        <!-- Lights -->
                        <path d="M5,30 L10,30 L10,35 L5,35 Z" fill="#ffcc00" />
                        <path d="M90,30 L95,30 L95,35 L90,35 Z" fill="#ff3300" />
                        <!-- Highlights and shadows -->
                        <path d="M15,15 L85,15" stroke="#ffffff" stroke-width="1" opacity="0.5" />
                        <path d="M30,10 L70,10" stroke="#ffffff" stroke-width="1" opacity="0.5" />
                        <path d="M5,30 L95,30" stroke="#000000" stroke-width="1" opacity="0.5" />
                        <!-- Pixelated details -->
                        <rect x="45" y="20" width="10" height="5" fill="${darkenColor(carColor)}" />
                        <rect x="40" y="35" width="20" height="5" fill="${darkenColor(carColor)}" />
                        <rect x="65" y="30" width="5" height="5" fill="${darkenColor(carColor)}" />
                        <rect x="30" y="30" width="5" height="5" fill="${darkenColor(carColor)}" />
                    </svg>`;
                }
                
                // Helper functions for color manipulation
                function darkenColor(color) {
                    // Simple function to darken a hex color
                    if (color.startsWith('#')) {
                        let r = parseInt(color.substr(1, 2), 16);
                        let g = parseInt(color.substr(3, 2), 16);
                        let b = parseInt(color.substr(5, 2), 16);
                        
                        r = Math.floor(r * 0.7);
                        g = Math.floor(g * 0.7);
                        b = Math.floor(b * 0.7);
                        
                        return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
                    }
                    return color;
                }
                
                function lightenColor(color) {
                    // Simple function to lighten a hex color
                    if (color.startsWith('#')) {
                        let r = parseInt(color.substr(1, 2), 16);
                        let g = parseInt(color.substr(3, 2), 16);
                        let b = parseInt(color.substr(5, 2), 16);
                        
                        r = Math.min(255, Math.floor(r * 1.3));
                        g = Math.min(255, Math.floor(g * 1.3));
                        b = Math.min(255, Math.floor(b * 1.3));
                        
                        return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
                    }
                    return color;
                }
                
                // Convert SVG to data URL
                const svgEncoded = encodeURIComponent(carSvg);
                car.style.backgroundImage = `url("data:image/svg+xml,${svgEncoded}")`;
                car.style.imageRendering = 'pixelated';
                
                gameScreen.appendChild(car);
                
                // Set lane and position
                let lane, speed;
                if (isRearEndCar) {
                    // Aggressive car that will try to hit player from the side
                    lane = playerLane;
                    car.style.left = '640px'; // Start from right side
                    speed = -8; // Negative speed to move left
                    car.dataset.isAggressiveCar = 'true';
                    car.style.filter = "hue-rotate(300deg) brightness(1.5)"; // Purple-ish glow
                    car.style.boxShadow = "0 0 15px #f00, 0 0 25px #f00"; // Red glow effect
                } else {
                    // Regular traffic
                    lane = Math.floor(Math.random() * 3); // Random lane (0-2)
                    car.style.left = '640px'; // Start from right side
                    speed = -(3 + Math.random() * 2); // Random speed between -3 and -5 (moving left)
                }
                
                // Set vertical position based on lane
                const lanePositionsY = [300, 320, 340]; // Y positions for the 3 lanes
                car.style.top = lanePositionsY[lane] + 'px';
                
                return {
                    element: car,
                    lane: lane,
                    x: parseInt(car.style.left),
                    width: width,
                    height: height,
                    speed: speed,
                    isAggressiveCar: isRearEndCar
                };
            }

            // Check for collision between player and a traffic car
            function checkCollision(trafficCar) {
                // Only check cars in the same lane as the player
                if (trafficCar.lane !== playerLane) return false;
                
                // Side collision detection
                const playerLeft = 100; // Player car's left edge
                const playerRight = playerLeft + 100; // Player car's right edge
                const trafficLeft = trafficCar.x;
                const trafficRight = trafficLeft + trafficCar.width;
                
                // Check if the cars are overlapping horizontally
                if (playerRight >= trafficLeft && playerLeft <= trafficRight) {
                    return true;
                }
                
                return false;
            }

            // Start the game
            function startGame() {
                titleScreen.style.display = 'none';
                winScreen.style.display = 'none';
                loseScreen.style.display = 'none';
                gameActive = true;
                score = 0;
                gameTime = 0;
                playerLane = 1; // Start in middle lane
                trafficCars = [];
                aggressiveDriverSpawned = false;
                
                // Clean up previous cars
                document.querySelectorAll('.traffic-car').forEach(car => {
                    car.remove();
                });
                
                updateScore();
                updateTime();
                updatePlayerLane();
                initLanes();
                
                // Set a timer for when the aggressive driver will appear
                // This will be between 15-25 seconds into the game
                const aggressiveDriverTime = Math.floor(Math.random() * 10000) + 15000;
                crashTimeout = setTimeout(spawnAggressiveDriver, aggressiveDriverTime);
                
                // Start the game timer
                gameTimer = setInterval(() => {
                    gameTime++;
                    updateTime();
                    
                    // Spawn regular traffic every 2-4 seconds
                    if (gameTime % (Math.floor(Math.random() * 3) + 2) === 0) {
                        trafficCars.push(createTrafficCar(false));
                    }
                    
                    // Increase score based on time survived
                    score += 10;
                    updateScore();
                }, 1000);
                
                // Create some initial traffic
                for (let i = 0; i < 3; i++) {
                    setTimeout(() => {
                        if (gameActive) trafficCars.push(createTrafficCar(false));
                    }, i * 1000);
                }
                
                gameLoop();
            }

            // Game loop
            function gameLoop() {
                if (!gameActive) return;
                
                // Move lane lines
                moveRoadLines();
                
                // Move traffic cars
                moveTrafficCars();
                
                // Check for collisions
                checkCollisions();
                
                // Continue the loop
                requestAnimationFrame(gameLoop);
            }

            // Move road lines to create scrolling effect
            function moveRoadLines() {
                roadLines.forEach(line => {
                    line.x -= 5; // Speed of road movement
                    
                    if (line.x < -80) {
                        line.x = 640; // Reset to right side when off-screen
                    }
                    
                    line.element.style.left = line.x + 'px';
                });
            }
            
            // Move all traffic cars
            function moveTrafficCars() {
                for (let i = trafficCars.length - 1; i >= 0; i--) {
                    const car = trafficCars[i];
                    
                    // Move car left
                    car.x += car.speed;
                    car.element.style.left = car.x + 'px';
                    
                    // Remove cars that have moved off-screen
                    if (car.x < -150) {
                        gameScreen.removeChild(car.element);
                        trafficCars.splice(i, 1);
                        
                        // Add points for successfully avoiding a car
                        if (!car.isAggressiveCar) {
                            score += 5;
                            updateScore();
                        }
                    }
                }
            }
            
            // Check for collisions with traffic
            function checkCollisions() {
                for (let i = 0; i < trafficCars.length; i++) {
                    if (checkCollision(trafficCars[i])) {
                        triggerCrash(trafficCars[i]);
                        break;
                    }
                }
            }
            
            // Trigger the crash event
            function triggerCrash(crashingCar) {
                if (!gameActive) return;
                
                gameActive = false;
                clearTimeout(crashTimeout);
                clearInterval(gameTimer);
                
                // Create a more dramatic crash animation
                crashAnimation.style.display = 'block';
                crashAnimation.style.backgroundColor = '#fff';
                
                // Add car shake effect to player car
                playerCar.style.animation = "crash-shake 0.1s 8";
                
                // Add CSS animation for crash shake if it doesn't exist
                if (!document.getElementById('crash-animation-style')) {
                    const styleSheet = document.createElement('style');
                    styleSheet.id = 'crash-animation-style';
                    styleSheet.textContent = `
                        @keyframes crash-shake {
                            0% { transform: translate(0, 0) scaleX(-1); }
                            10% { transform: translate(-5px, -3px) scaleX(-1); }
                            20% { transform: translate(5px, 3px) scaleX(-1); }
                            30% { transform: translate(-5px, 2px) scaleX(-1); }
                            40% { transform: translate(5px, -2px) scaleX(-1); }
                            50% { transform: translate(-5px, 3px) scaleX(-1); }
                            60% { transform: translate(5px, -3px) scaleX(-1); }
                            70% { transform: translate(-3px, 2px) scaleX(-1); }
                            80% { transform: translate(3px, -2px) scaleX(-1); }
                            90% { transform: translate(-2px, 1px) scaleX(-1); }
                            100% { transform: translate(0, 0) scaleX(-1); }
                        }
                    `;
                    document.head.appendChild(styleSheet);
                }
                
                // Create flying debris particles
                for (let i = 0; i < 15; i++) {
                    const debris = document.createElement('div');
                    debris.style.position = 'absolute';
                    debris.style.width = Math.random() * 10 + 5 + 'px';
                    debris.style.height = Math.random() * 10 + 5 + 'px';
                    debris.style.backgroundColor = i % 3 === 0 ? '#f00' : (i % 3 === 1 ? '#ddd' : '#000');
                    debris.style.borderRadius = '50%';
                    debris.style.left = (playerCar.offsetLeft + Math.random() * 50) + 'px';
                    debris.style.bottom = (parseInt(playerCar.style.bottom) + 30 + Math.random() * 20) + 'px';
                    debris.style.zIndex = '15';
                    
                    // Random animation for each debris
                    const angle = Math.random() * 360;
                    const distance = 50 + Math.random() * 100;
                    const duration = 0.5 + Math.random() * 1;
                    
                    debris.style.animation = `debris-fly ${duration}s forwards`;
                    
                    // Add debris animation
                    if (!document.getElementById('debris-animation')) {
                        const debrisStyle = document.createElement('style');
                        debrisStyle.id = 'debris-animation';
                        debrisStyle.textContent = `
                            @keyframes debris-fly {
                                0% { transform: translate(0, 0); opacity: 1; }
                                100% { transform: translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px); opacity: 0; }
                            }
                        `;
                        document.head.appendChild(debrisStyle);
                    }
                    
                    gameScreen.appendChild(debris);
                    
                    // Remove debris after animation
                    setTimeout(() => {
                        if (debris.parentNode) {
                            debris.parentNode.removeChild(debris);
                        }
                    }, duration * 1000);
                }
                
                setTimeout(() => {
                    crashAnimation.style.backgroundColor = 'transparent';
                    
                    // Show "CRASH" text with more dramatic styling
                    crashAnimation.innerHTML = `
                        <div style="position:absolute; top:40%; left:50%; transform:translate(-50%, -50%) rotate(-10deg); font-size:72px; color:#f00; font-weight:bold; text-shadow:3px 3px 0 #000, 0 0 20px #f00;">CRASH!!!</div>
                        <div style="position:absolute; top:55%; left:50%; transform:translate(-50%, -50%); font-size:36px; color:#ff0; font-weight:bold; text-shadow:2px 2px 0 #f00;">FENDER BENDER!</div>
                    `;
                    
                    // Play enhanced crash sound
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    
                    // First crash sound (higher pitch)
                    const crashSound1 = audioContext.createOscillator();
                    crashSound1.type = 'sawtooth';
                    crashSound1.frequency.setValueAtTime(220, audioContext.currentTime);
                    crashSound1.frequency.exponentialRampToValueAtTime(110, audioContext.currentTime + 0.5);
                    
                    const crashGain1 = audioContext.createGain();
                    crashGain1.gain.setValueAtTime(0.3, audioContext.currentTime);
                    crashGain1.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    
                    crashSound1.connect(crashGain1);
                    crashGain1.connect(audioContext.destination);
                    
                    crashSound1.start();
                    crashSound1.stop(audioContext.currentTime + 0.5);
                    
                    // Second crash sound (lower pitch, slightly delayed)
                    setTimeout(() => {
                        const crashSound2 = audioContext.createOscillator();
                        crashSound2.type = 'square';
                        crashSound2.frequency.setValueAtTime(150, audioContext.currentTime);
                        crashSound2.frequency.exponentialRampToValueAtTime(40, audioContext.currentTime + 0.7);
                        
                        const crashGain2 = audioContext.createGain();
                        crashGain2.gain.setValueAtTime(0.2, audioContext.currentTime);
                        crashGain2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.7);
                        
                        crashSound2.connect(crashGain2);
                        crashGain2.connect(audioContext.destination);
                        
                        crashSound2.start();
                        crashSound2.stop(audioContext.currentTime + 0.7);
                    }, 100);
                    
                    // Show crash screen after a brief delay
                    setTimeout(() => {
                        crashAnimation.style.display = 'none';
                        crashScreen.style.display = 'flex';
                    }, 2000);
                }, 100);
            }

            // Spawn the "aggressive driver" that will try to hit the player
            function spawnAggressiveDriver() {
                if (!gameActive) return;
                
                aggressiveDriverSpawned = true;
                
                // Update player lane for the crash
                playerLane = Math.floor(Math.random() * 3); // Random lane for player
                updatePlayerLane();
                
                const aggressiveDriver = createTrafficCar(true);
                aggressiveDriver.lane = playerLane; // Make sure it targets the player
                
                // Make this car more visually distinct and menacing
                aggressiveDriver.speed = -8; // Faster than regular traffic
                aggressiveDriver.element.style.filter = "hue-rotate(300deg) brightness(1.5)"; // Purple-ish glow
                aggressiveDriver.element.style.boxShadow = "0 0 15px #f00, 0 0 25px #f00"; // Red glow effect
                aggressiveDriver.element.style.animation = "shake 0.1s infinite"; // Add shaking effect
                
                // Add CSS animation for shaking effect if it doesn't exist
                if (!document.getElementById('shake-animation')) {
                    const styleSheet = document.createElement('style');
                    styleSheet.id = 'shake-animation';
                    styleSheet.textContent = `
                        @keyframes shake {
                            0% { transform: translateX(-1px); }
                            25% { transform: translateX(1px); }
                            50% { transform: translateX(-1px); }
                            75% { transform: translateX(1px); }
                            100% { transform: translateX(-1px); }
                        }
                    `;
                    document.head.appendChild(styleSheet);
                }
                
                // Position the car at the correct lane
                aggressiveDriver.element.style.top = lanePositionsY[playerLane] + 'px';
                
                trafficCars.push(aggressiveDriver);
                
                // Add a visual alert
                const alert = document.createElement('div');
                alert.textContent = "! AGGRESSIVE DRIVER APPROACHING !";
                alert.style.position = "absolute";
                alert.style.top = "50px";
                alert.style.left = "50%";
                alert.style.transform = "translateX(-50%)";
                alert.style.color = "#f00";
                alert.style.fontSize = "24px";
                alert.style.fontWeight = "bold";
                alert.style.textShadow = "2px 2px 0 #000";
                alert.style.zIndex = "20";
                gameScreen.appendChild(alert);
                
                // Remove alert after 3 seconds
                setTimeout(() => {
                    if (alert.parentNode) {
                        alert.parentNode.removeChild(alert);
                    }
                }, 3000);
            }

            // Update score display
            function updateScore() {
                scoreDisplay.textContent = `SCORE: ${score}`;
            }

            // Update time display
            function updateTime() {
                timeDisplay.textContent = `TIME: ${gameTime}s`;
            }

            // Show win screen
            function showWinScreen() {
                crashScreen.style.display = 'none';
                winScreen.style.display = 'flex';
            }

            // Show lose screen
            function showLoseScreen() {
                crashScreen.style.display = 'none';
                loseScreen.style.display = 'flex';
            }

            // Event listeners
            startButton.addEventListener('click', startGame);
            callButton.addEventListener('click', showWinScreen);
            noCallButton.addEventListener('click', showLoseScreen);
            playAgainButton.addEventListener('click', startGame);
            tryAgainButton.addEventListener('click', startGame);
            contactButton.addEventListener('click', () => {
                winScreen.style.display = 'none';
                contactSection.style.display = 'flex';
            });
            backButton.addEventListener('click', () => {
                contactSection.style.display = 'none';
                winScreen.style.display = 'flex';
            });
            aboutButton.addEventListener('click', () => {
                winScreen.style.display = 'none';
                aboutSection.style.display = 'block';
            });
            aboutBackButton.addEventListener('click', () => {
                aboutSection.style.display = 'none';
                winScreen.style.display = 'flex';
            });

            // Navigation buttons
            gameNav.addEventListener('click', () => {
                contactSection.style.display = 'none';
                aboutSection.style.display = 'none';
                if (!gameActive) {
                    titleScreen.style.display = 'flex';
                }
            });
            aboutNav.addEventListener('click', () => {
                titleScreen.style.display = 'none';
                contactSection.style.display = 'none';
                aboutSection.style.display = 'block';
            });
            contactNav.addEventListener('click', () => {
                titleScreen.style.display = 'none';
                aboutSection.style.display = 'none';
                contactSection.style.display = 'flex';
            });

            // Keyboard controls
            document.addEventListener('keydown', (e) => {
                if (!gameActive) return;
                
                if (e.key === 'ArrowUp' && playerLane > 0) {
                    playerLane--;
                    updatePlayerLane();
                } else if (e.key === 'ArrowDown' && playerLane < 2) {
                    playerLane++;
                    updatePlayerLane();
                }
            });

            // Contact form submission
            document.getElementById('contact-form').addEventListener('submit', function(e) {
                e.preventDefault();
                alert('Thanks for contacting Mike Brown Law! We will be in touch soon.');
                contactSection.style.display = 'none';
                titleScreen.style.display = 'flex';
            });

            // Initialize the game
            initLanes();
            updatePlayerLane();
        });
    </script>
</body>
</html>